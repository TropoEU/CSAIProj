{"version":3,"file":"widget.js","sources":["../src/api.js","../src/storage.js","../src/components/bubble.js","../src/components/messages.js","../src/components/input.js","../src/components/window.js","../src/widget.js","../src/index.js"],"sourcesContent":["/**\r\n * API Client for CSAI Chat Widget\r\n * Handles all communication with the backend API\r\n */\r\nexport class ChatAPI {\r\n  constructor(apiKey, baseUrl) {\r\n    this.apiKey = apiKey;\r\n    this.baseUrl = baseUrl.replace(/\\/$/, ''); // Remove trailing slash\r\n  }\r\n\r\n  /**\r\n   * Send a message to the AI and get a response\r\n   * @param {string} sessionId - Unique session identifier\r\n   * @param {string} message - User's message\r\n   * @returns {Promise<Object>} Response with AI message and metadata\r\n   */\r\n  async sendMessage(sessionId, message) {\r\n    try {\r\n      const response = await fetch(`${this.baseUrl}/chat/message`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${this.apiKey}`,\r\n        },\r\n        body: JSON.stringify({\r\n          sessionId,\r\n          message,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json().catch(() => ({}));\r\n        throw new Error(error.error || `HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('ChatAPI: Failed to send message', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get conversation history for a session\r\n   * @param {string} sessionId - Session identifier\r\n   * @returns {Promise<Array>} Array of messages\r\n   */\r\n  async getHistory(sessionId) {\r\n    try {\r\n      const response = await fetch(`${this.baseUrl}/chat/history/${sessionId}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${this.apiKey}`,\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json().catch(() => ({}));\r\n        throw new Error(error.error || `HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      return data.messages || [];\r\n    } catch (error) {\r\n      console.error('ChatAPI: Failed to get history', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * End a conversation session\r\n   * @param {string} sessionId - Session identifier\r\n   * @returns {Promise<Object>} Confirmation response\r\n   */\r\n  async endSession(sessionId) {\r\n    try {\r\n      const response = await fetch(`${this.baseUrl}/chat/end`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${this.apiKey}`,\r\n        },\r\n        body: JSON.stringify({\r\n          sessionId,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json().catch(() => ({}));\r\n        throw new Error(error.error || `HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('ChatAPI: Failed to end session', error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Storage wrapper for managing widget state in localStorage\r\n * Handles session persistence, message history, and widget state\r\n */\r\nexport class WidgetStorage {\r\n  constructor(prefix = 'csai_widget') {\r\n    this.prefix = prefix;\r\n    this.isAvailable = this.checkAvailability();\r\n  }\r\n\r\n  /**\r\n   * Check if localStorage is available\r\n   * @returns {boolean}\r\n   */\r\n  checkAvailability() {\r\n    try {\r\n      const test = '__storage_test__';\r\n      localStorage.setItem(test, test);\r\n      localStorage.removeItem(test);\r\n      return true;\r\n    } catch (e) {\r\n      console.warn('WidgetStorage: localStorage is not available', e);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate a unique session ID\r\n   * @returns {string}\r\n   */\r\n  generateSessionId() {\r\n    const timestamp = Date.now();\r\n    const random = Math.random().toString(36).substring(2, 15);\r\n    return `session_${timestamp}_${random}`;\r\n  }\r\n\r\n  /**\r\n   * Get or create a session ID\r\n   * @returns {string}\r\n   */\r\n  getSessionId() {\r\n    let sessionId = this.get('sessionId');\r\n    if (!sessionId) {\r\n      sessionId = this.generateSessionId();\r\n      this.set('sessionId', sessionId);\r\n    }\r\n    return sessionId;\r\n  }\r\n\r\n  /**\r\n   * Get a value from localStorage\r\n   * @param {string} key - Storage key\r\n   * @returns {any} Parsed value or null\r\n   */\r\n  get(key) {\r\n    if (!this.isAvailable) return null;\r\n\r\n    try {\r\n      const fullKey = `${this.prefix}_${key}`;\r\n      const value = localStorage.getItem(fullKey);\r\n      return value ? JSON.parse(value) : null;\r\n    } catch (e) {\r\n      console.error(`WidgetStorage: Failed to get ${key}`, e);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set a value in localStorage\r\n   * @param {string} key - Storage key\r\n   * @param {any} value - Value to store\r\n   */\r\n  set(key, value) {\r\n    if (!this.isAvailable) return;\r\n\r\n    try {\r\n      const fullKey = `${this.prefix}_${key}`;\r\n      localStorage.setItem(fullKey, JSON.stringify(value));\r\n    } catch (e) {\r\n      console.error(`WidgetStorage: Failed to set ${key}`, e);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a value from localStorage\r\n   * @param {string} key - Storage key\r\n   */\r\n  remove(key) {\r\n    if (!this.isAvailable) return;\r\n\r\n    try {\r\n      const fullKey = `${this.prefix}_${key}`;\r\n      localStorage.removeItem(fullKey);\r\n    } catch (e) {\r\n      console.error(`WidgetStorage: Failed to remove ${key}`, e);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save conversation messages (keep last 20)\r\n   * @param {Array} messages - Array of message objects\r\n   */\r\n  saveMessages(messages) {\r\n    const recentMessages = messages.slice(-20);\r\n    this.set('messages', recentMessages);\r\n  }\r\n\r\n  /**\r\n   * Get saved conversation messages\r\n   * @returns {Array} Array of message objects\r\n   */\r\n  getMessages() {\r\n    return this.get('messages') || [];\r\n  }\r\n\r\n  /**\r\n   * Save widget state (open/closed)\r\n   * @param {boolean} isOpen - Whether widget is open\r\n   */\r\n  setWidgetState(isOpen) {\r\n    this.set('widgetOpen', isOpen);\r\n  }\r\n\r\n  /**\r\n   * Get widget state\r\n   * @returns {boolean} Whether widget should be open\r\n   */\r\n  getWidgetState() {\r\n    return this.get('widgetOpen') || false;\r\n  }\r\n\r\n  /**\r\n   * Save unread message count\r\n   * @param {number} count - Number of unread messages\r\n   */\r\n  setUnreadCount(count) {\r\n    this.set('unreadCount', count);\r\n  }\r\n\r\n  /**\r\n   * Get unread message count\r\n   * @returns {number}\r\n   */\r\n  getUnreadCount() {\r\n    return this.get('unreadCount') || 0;\r\n  }\r\n\r\n  /**\r\n   * Clear all widget data\r\n   */\r\n  clearAll() {\r\n    if (!this.isAvailable) return;\r\n\r\n    const keys = ['sessionId', 'messages', 'widgetOpen', 'unreadCount'];\r\n    keys.forEach(key => this.remove(key));\r\n  }\r\n}\r\n","/**\r\n * Chat Bubble Component\r\n * The circular button that opens/closes the chat widget\r\n */\r\nexport class ChatBubble {\r\n  constructor(onClick, config = {}) {\r\n    this.onClick = onClick;\r\n    this.config = config;\r\n    this.element = this.create();\r\n    this.unreadCount = 0;\r\n    this.applyColors();\r\n  }\r\n\r\n  /**\r\n   * Create the bubble element\r\n   * @returns {HTMLElement}\r\n   */\r\n  create() {\r\n    const bubble = document.createElement('button');\r\n    bubble.className = 'csai-chat-bubble';\r\n    bubble.setAttribute('aria-label', 'Open chat');\r\n\r\n    bubble.innerHTML = `\r\n      <svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <path d=\"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z\"/>\r\n      </svg>\r\n    `;\r\n\r\n    bubble.addEventListener('click', () => {\r\n      this.onClick();\r\n      this.toggleOpen();\r\n    });\r\n\r\n    return bubble;\r\n  }\r\n\r\n  /**\r\n   * Apply custom colors from config\r\n   */\r\n  applyColors() {\r\n    // Apply header background color to bubble\r\n    if (this.config.headerBgColor) {\r\n      this.element.style.backgroundColor = this.config.headerBgColor;\r\n    }\r\n\r\n    // Apply header text color to SVG icon\r\n    if (this.config.headerTextColor) {\r\n      const svg = this.element.querySelector('svg');\r\n      if (svg) {\r\n        svg.style.fill = this.config.headerTextColor;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle open state animation\r\n   */\r\n  toggleOpen() {\r\n    this.element.classList.toggle('open');\r\n  }\r\n\r\n  /**\r\n   * Update unread message count\r\n   * @param {number} count - Number of unread messages\r\n   */\r\n  setUnreadCount(count) {\r\n    this.unreadCount = count;\r\n\r\n    // Remove existing badge if present\r\n    const existingBadge = this.element.querySelector('.csai-unread-badge');\r\n    if (existingBadge) {\r\n      existingBadge.remove();\r\n    }\r\n\r\n    // Add new badge if count > 0\r\n    if (count > 0) {\r\n      const badge = document.createElement('span');\r\n      badge.className = 'csai-unread-badge';\r\n      badge.textContent = count > 99 ? '99+' : count;\r\n      this.element.appendChild(badge);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the bubble element\r\n   * @returns {HTMLElement}\r\n   */\r\n  getElement() {\r\n    return this.element;\r\n  }\r\n}\r\n","/**\r\n * Messages Component\r\n * Displays the list of conversation messages\r\n */\r\nexport class MessageList {\r\n  constructor() {\r\n    this.element = this.create();\r\n    this.messages = [];\r\n  }\r\n\r\n  /**\r\n   * Create the messages container\r\n   * @returns {HTMLElement}\r\n   */\r\n  create() {\r\n    const container = document.createElement('div');\r\n    container.className = 'csai-messages';\r\n    return container;\r\n  }\r\n\r\n  /**\r\n   * Add a message to the list\r\n   * @param {Object} message - Message object\r\n   * @param {string} message.role - 'user' or 'assistant'\r\n   * @param {string} message.content - Message text\r\n   * @param {Date} message.timestamp - Message timestamp\r\n   */\r\n  addMessage(message) {\r\n    this.messages.push(message);\r\n\r\n    const messageEl = this.createMessageElement(message);\r\n    this.element.appendChild(messageEl);\r\n\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  /**\r\n   * Create a message element\r\n   * @param {Object} message - Message object\r\n   * @returns {HTMLElement}\r\n   */\r\n  createMessageElement(message) {\r\n    const messageDiv = document.createElement('div');\r\n    messageDiv.className = `csai-message ${message.role === 'user' ? 'user' : 'ai'}`;\r\n\r\n    const bubble = document.createElement('div');\r\n    bubble.className = 'csai-message-bubble';\r\n    bubble.textContent = message.content;\r\n\r\n    const time = document.createElement('div');\r\n    time.className = 'csai-message-time';\r\n    time.textContent = this.formatTime(message.timestamp);\r\n\r\n    messageDiv.appendChild(bubble);\r\n    messageDiv.appendChild(time);\r\n\r\n    return messageDiv;\r\n  }\r\n\r\n  /**\r\n   * Format timestamp to readable time\r\n   * @param {Date|string} timestamp\r\n   * @returns {string}\r\n   */\r\n  formatTime(timestamp) {\r\n    const date = timestamp instanceof Date ? timestamp : new Date(timestamp);\r\n    const hours = date.getHours().toString().padStart(2, '0');\r\n    const minutes = date.getMinutes().toString().padStart(2, '0');\r\n    return `${hours}:${minutes}`;\r\n  }\r\n\r\n  /**\r\n   * Show typing indicator\r\n   */\r\n  showTyping() {\r\n    this.hideTyping(); // Remove any existing typing indicator\r\n\r\n    const typing = document.createElement('div');\r\n    typing.className = 'csai-message ai';\r\n    typing.setAttribute('data-typing', 'true');\r\n\r\n    const indicator = document.createElement('div');\r\n    indicator.className = 'csai-typing-indicator';\r\n    indicator.innerHTML = `\r\n      <div class=\"csai-typing-dot\"></div>\r\n      <div class=\"csai-typing-dot\"></div>\r\n      <div class=\"csai-typing-dot\"></div>\r\n    `;\r\n\r\n    typing.appendChild(indicator);\r\n    this.element.appendChild(typing);\r\n\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  /**\r\n   * Hide typing indicator\r\n   */\r\n  hideTyping() {\r\n    const typing = this.element.querySelector('[data-typing=\"true\"]');\r\n    if (typing) {\r\n      typing.remove();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show an error message with retry option\r\n   * @param {string} errorText - Error message\r\n   * @param {Function} onRetry - Retry callback\r\n   */\r\n  showError(errorText, onRetry) {\r\n    const errorDiv = document.createElement('div');\r\n    errorDiv.className = 'csai-error-message';\r\n\r\n    errorDiv.innerHTML = `\r\n      <svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z\"/>\r\n      </svg>\r\n      <div>\r\n        <div>${errorText}</div>\r\n        ${onRetry ? '<button class=\"csai-retry-button\">Retry</button>' : ''}\r\n      </div>\r\n    `;\r\n\r\n    if (onRetry) {\r\n      const retryBtn = errorDiv.querySelector('.csai-retry-button');\r\n      retryBtn.addEventListener('click', () => {\r\n        errorDiv.remove();\r\n        onRetry();\r\n      });\r\n    }\r\n\r\n    this.element.appendChild(errorDiv);\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  /**\r\n   * Load multiple messages at once\r\n   * @param {Array} messages - Array of message objects\r\n   */\r\n  loadMessages(messages) {\r\n    this.clear();\r\n    \r\n    // Filter out system and tool messages (safety check - should never happen)\r\n    const filteredMessages = messages.filter(msg => \r\n      msg.role === 'user' || msg.role === 'assistant'\r\n    );\r\n    \r\n    this.messages = filteredMessages;\r\n\r\n    filteredMessages.forEach(message => {\r\n      const messageEl = this.createMessageElement(message);\r\n      this.element.appendChild(messageEl);\r\n    });\r\n\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  /**\r\n   * Clear all messages\r\n   */\r\n  clear() {\r\n    this.element.innerHTML = '';\r\n    this.messages = [];\r\n  }\r\n\r\n  /**\r\n   * Show empty state\r\n   * @param {string} greeting - Greeting message\r\n   */\r\n  showEmptyState(greeting) {\r\n    this.clear();\r\n\r\n    const emptyState = document.createElement('div');\r\n    emptyState.className = 'csai-empty-state';\r\n\r\n    emptyState.innerHTML = `\r\n      <svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <path d=\"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z\"/>\r\n      </svg>\r\n      <div class=\"csai-empty-title\">Start a conversation</div>\r\n      <div class=\"csai-empty-subtitle\">${greeting}</div>\r\n    `;\r\n\r\n    this.element.appendChild(emptyState);\r\n  }\r\n\r\n  /**\r\n   * Scroll to the bottom of messages\r\n   */\r\n  scrollToBottom() {\r\n    setTimeout(() => {\r\n      this.element.scrollTop = this.element.scrollHeight;\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * Get the container element\r\n   * @returns {HTMLElement}\r\n   */\r\n  getElement() {\r\n    return this.element;\r\n  }\r\n\r\n  /**\r\n   * Get all messages\r\n   * @returns {Array}\r\n   */\r\n  getMessages() {\r\n    return this.messages;\r\n  }\r\n}\r\n","/**\r\n * Input Component\r\n * Text input area with send button\r\n */\r\nexport class InputArea {\r\n  constructor(onSend, config = {}) {\r\n    this.onSend = onSend;\r\n    this.config = config;\r\n    this.element = this.create();\r\n    this.input = this.element.querySelector('.csai-input');\r\n    this.sendButton = this.element.querySelector('.csai-send-button');\r\n    this.applyColors();\r\n  }\r\n\r\n  /**\r\n   * Create the input area element\r\n   * @returns {HTMLElement}\r\n   */\r\n  create() {\r\n    const container = document.createElement('div');\r\n    container.className = 'csai-input-area';\r\n\r\n    container.innerHTML = `\r\n      <textarea\r\n        class=\"csai-input\"\r\n        placeholder=\"Type your message...\"\r\n        rows=\"1\"\r\n        aria-label=\"Message input\"\r\n      ></textarea>\r\n      <button class=\"csai-send-button\" aria-label=\"Send message\">\r\n        <svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n          <path d=\"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\"/>\r\n        </svg>\r\n      </button>\r\n    `;\r\n\r\n    const input = container.querySelector('.csai-input');\r\n    const sendButton = container.querySelector('.csai-send-button');\r\n\r\n    // Handle input changes\r\n    input.addEventListener('input', () => {\r\n      this.autoResize();\r\n      this.updateSendButton();\r\n    });\r\n\r\n    // Handle Enter key (send on Enter, new line on Shift+Enter)\r\n    input.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter' && !e.shiftKey) {\r\n        e.preventDefault();\r\n        this.handleSend();\r\n      }\r\n    });\r\n\r\n    // Handle send button click\r\n    sendButton.addEventListener('click', () => {\r\n      this.handleSend();\r\n    });\r\n\r\n    return container;\r\n  }\r\n\r\n  /**\r\n   * Apply custom colors from config\r\n   */\r\n  applyColors() {\r\n    // Apply footer background color\r\n    if (this.config.footerBgColor) {\r\n      this.element.style.backgroundColor = this.config.footerBgColor;\r\n    }\r\n\r\n    // Apply input background color\r\n    if (this.config.inputBgColor) {\r\n      this.input.style.backgroundColor = this.config.inputBgColor;\r\n    }\r\n\r\n    // Apply input text color\r\n    if (this.config.inputTextColor) {\r\n      this.input.style.color = this.config.inputTextColor;\r\n    }\r\n\r\n    // Apply button text color (to SVG fill) - ensure size is correct\r\n    if (this.config.buttonTextColor) {\r\n      const svg = this.sendButton.querySelector('svg');\r\n      if (svg) {\r\n        svg.style.fill = this.config.buttonTextColor;\r\n        svg.style.width = '18px';\r\n        svg.style.height = '18px';\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Auto-resize textarea based on content\r\n   */\r\n  autoResize() {\r\n    this.input.style.height = 'auto';\r\n    this.input.style.height = Math.min(this.input.scrollHeight, 100) + 'px';\r\n  }\r\n\r\n  /**\r\n   * Update send button state based on input\r\n   */\r\n  updateSendButton() {\r\n    const hasText = this.input.value.trim().length > 0;\r\n    this.sendButton.disabled = !hasText;\r\n  }\r\n\r\n  /**\r\n   * Handle send action\r\n   */\r\n  handleSend() {\r\n    const message = this.input.value.trim();\r\n\r\n    if (message && !this.sendButton.disabled) {\r\n      this.onSend(message);\r\n      this.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the input field\r\n   */\r\n  clear() {\r\n    this.input.value = '';\r\n    this.input.style.height = 'auto';\r\n    this.updateSendButton();\r\n    this.input.focus();\r\n  }\r\n\r\n  /**\r\n   * Set the input value\r\n   * @param {string} value - Text to set\r\n   */\r\n  setValue(value) {\r\n    this.input.value = value;\r\n    this.autoResize();\r\n    this.updateSendButton();\r\n  }\r\n\r\n  /**\r\n   * Focus the input field\r\n   */\r\n  focus() {\r\n    this.input.focus();\r\n  }\r\n\r\n  /**\r\n   * Disable the input\r\n   */\r\n  disable() {\r\n    this.input.disabled = true;\r\n    this.sendButton.disabled = true;\r\n  }\r\n\r\n  /**\r\n   * Enable the input\r\n   */\r\n  enable() {\r\n    this.input.disabled = false;\r\n    this.updateSendButton();\r\n  }\r\n\r\n  /**\r\n   * Get the container element\r\n   * @returns {HTMLElement}\r\n   */\r\n  getElement() {\r\n    return this.element;\r\n  }\r\n}\r\n","import { MessageList } from './messages.js';\r\nimport { InputArea } from './input.js';\r\n\r\n/**\r\n * Chat Window Component\r\n * The main chat interface with header, messages, and input\r\n */\r\nexport class ChatWindow {\r\n  constructor(config, onClose, onSend) {\r\n    this.config = config;\r\n    this.onClose = onClose;\r\n    this.onSend = onSend;\r\n    this.element = this.create();\r\n    this.messageList = new MessageList();\r\n    this.inputArea = new InputArea((message) => this.handleSend(message), config);\r\n    this.isOpen = false;\r\n  }\r\n\r\n  /**\r\n   * Create the window element\r\n   * @returns {HTMLElement}\r\n   */\r\n  create() {\r\n    const window = document.createElement('div');\r\n    window.className = 'csai-chat-window csai-hidden';\r\n\r\n    const header = this.createHeader();\r\n    window.appendChild(header);\r\n\r\n    return window;\r\n  }\r\n\r\n  /**\r\n   * Create the window header\r\n   * @returns {HTMLElement}\r\n   */\r\n  createHeader() {\r\n    const header = document.createElement('div');\r\n    header.className = 'csai-window-header';\r\n\r\n    const title = this.config.title || 'Chat Support';\r\n    const subtitle = this.config.subtitle || 'We typically reply instantly';\r\n\r\n    // Apply header text color if configured\r\n    if (this.config.headerTextColor) {\r\n      header.style.color = this.config.headerTextColor;\r\n    }\r\n\r\n    header.innerHTML = `\r\n      <div>\r\n        <div class=\"csai-header-title\">${title}</div>\r\n        <div class=\"csai-header-subtitle\">${subtitle}</div>\r\n      </div>\r\n      <div class=\"csai-header-actions\">\r\n        <button class=\"csai-header-button csai-close-button\" aria-label=\"Close\">\r\n          <svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    `;\r\n\r\n    // Apply header background color if configured\r\n    if (this.config.headerBgColor) {\r\n      header.style.backgroundColor = this.config.headerBgColor;\r\n    }\r\n\r\n    // Apply button text color to close button (should match send button icon color)\r\n    if (this.config.buttonTextColor) {\r\n      const closeButton = header.querySelector('.csai-close-button svg');\r\n      if (closeButton) {\r\n        closeButton.style.fill = this.config.buttonTextColor;\r\n      }\r\n    }\r\n\r\n    // Close button\r\n    const closeBtn = header.querySelector('.csai-close-button');\r\n    closeBtn.addEventListener('click', () => {\r\n      this.close();\r\n      if (this.onClose) {\r\n        this.onClose();\r\n      }\r\n    });\r\n\r\n    return header;\r\n  }\r\n\r\n  /**\r\n   * Initialize the window with messages and input\r\n   */\r\n  init() {\r\n    this.element.appendChild(this.messageList.getElement());\r\n    this.element.appendChild(this.inputArea.getElement());\r\n\r\n    // Show greeting message if no messages\r\n    if (this.messageList.getMessages().length === 0) {\r\n      const greeting = this.config.greeting || 'Hi! How can I help you today?';\r\n      this.messageList.showEmptyState(greeting);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle message send\r\n   * @param {string} message - User message\r\n   */\r\n  handleSend(message) {\r\n    if (this.onSend) {\r\n      this.onSend(message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Open the window\r\n   */\r\n  open() {\r\n    this.element.classList.remove('csai-hidden');\r\n    this.isOpen = true;\r\n    this.inputArea.focus();\r\n  }\r\n\r\n  /**\r\n   * Close the window\r\n   */\r\n  close() {\r\n    this.element.classList.add('csai-hidden');\r\n    this.isOpen = false;\r\n  }\r\n\r\n  /**\r\n   * Toggle window open/closed\r\n   */\r\n  toggle() {\r\n    if (this.isOpen) {\r\n      this.close();\r\n    } else {\r\n      this.open();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a message to the window\r\n   * @param {Object} message - Message object\r\n   */\r\n  addMessage(message) {\r\n    // If showing empty state, clear it first\r\n    const emptyState = this.element.querySelector('.csai-empty-state');\r\n    if (emptyState) {\r\n      emptyState.remove();\r\n    }\r\n\r\n    this.messageList.addMessage(message);\r\n  }\r\n\r\n  /**\r\n   * Load messages into the window\r\n   * @param {Array} messages - Array of message objects\r\n   */\r\n  loadMessages(messages) {\r\n    if (messages && messages.length > 0) {\r\n      this.messageList.loadMessages(messages);\r\n    } else {\r\n      const greeting = this.config.greeting || 'Hi! How can I help you today?';\r\n      this.messageList.showEmptyState(greeting);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show typing indicator\r\n   */\r\n  showTyping() {\r\n    this.messageList.showTyping();\r\n  }\r\n\r\n  /**\r\n   * Hide typing indicator\r\n   */\r\n  hideTyping() {\r\n    this.messageList.hideTyping();\r\n  }\r\n\r\n  /**\r\n   * Show error message\r\n   * @param {string} message - Error message\r\n   * @param {Function} onRetry - Retry callback\r\n   */\r\n  showError(message, onRetry) {\r\n    this.messageList.showError(message, onRetry);\r\n  }\r\n\r\n  /**\r\n   * Disable input\r\n   */\r\n  disableInput() {\r\n    this.inputArea.disable();\r\n  }\r\n\r\n  /**\r\n   * Enable input\r\n   */\r\n  enableInput() {\r\n    this.inputArea.enable();\r\n  }\r\n\r\n  /**\r\n   * Get the window element\r\n   * @returns {HTMLElement}\r\n   */\r\n  getElement() {\r\n    return this.element;\r\n  }\r\n\r\n  /**\r\n   * Get all messages\r\n   * @returns {Array}\r\n   */\r\n  getMessages() {\r\n    return this.messageList.getMessages();\r\n  }\r\n}\r\n","import { ChatAPI } from './api.js';\r\nimport { WidgetStorage } from './storage.js';\r\nimport { ChatBubble } from './components/bubble.js';\r\nimport { ChatWindow } from './components/window.js';\r\nimport styles from './styles.css?inline';\r\n\r\n/**\r\n * Main Chat Widget Class\r\n * Manages the entire widget lifecycle and state\r\n */\r\nexport class ChatWidget {\r\n  constructor(config) {\r\n    this.config = this.parseConfig(config);\r\n    this.api = new ChatAPI(this.config.apiKey, this.config.apiUrl);\r\n    this.storage = new WidgetStorage();\r\n    this.sessionId = this.storage.getSessionId();\r\n    this.container = null;\r\n    this.shadowRoot = null;\r\n    this.bubble = null;\r\n    this.window = null;\r\n    this.pendingMessage = null;\r\n\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * Parse and validate configuration\r\n   * @param {Object} config - Widget configuration\r\n   * @returns {Object} Parsed configuration\r\n   */\r\n  parseConfig(config) {\r\n    if (!config.apiKey) {\r\n      throw new Error('ChatWidget: apiKey is required');\r\n    }\r\n\r\n    return {\r\n      apiKey: config.apiKey,\r\n      // API URL is hardcoded in widget code - backend services communicate internally\r\n      // Set via VITE_API_URL environment variable at build time, or defaults to production\r\n      apiUrl: import.meta.env.VITE_API_URL || 'https://api.yourdomain.com',\r\n      position: config.position || 'bottom-right',\r\n      primaryColor: config.primaryColor || '#667eea',\r\n      backgroundColor: config.backgroundColor || '#ffffff',\r\n      headerBgColor: config.headerBgColor || config.primaryColor || '#667eea',\r\n      bodyBgColor: config.bodyBgColor || config.backgroundColor || '#ffffff',\r\n      footerBgColor: config.footerBgColor || config.backgroundColor || '#ffffff',\r\n      aiBubbleColor: config.aiBubbleColor || '#f3f4f6',\r\n      userBubbleColor: config.userBubbleColor || '#667eea',\r\n      headerTextColor: config.headerTextColor || '#111827',\r\n      aiTextColor: config.aiTextColor || '#111827',\r\n      userTextColor: config.userTextColor || '#ffffff',\r\n      inputBgColor: config.inputBgColor || '#f9fafb',\r\n      inputTextColor: config.inputTextColor || '#111827',\r\n      buttonTextColor: config.buttonTextColor || '#ffffff',\r\n      greeting: config.greeting || 'Hi! How can I help you today?',\r\n      title: config.title || 'Chat Support',\r\n      subtitle: config.subtitle || 'We typically reply instantly',\r\n      ...config,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Initialize the widget\r\n   */\r\n  init() {\r\n    this.createContainer();\r\n    this.createShadowDOM();\r\n    this.injectStyles();\r\n    this.createComponents();\r\n    this.loadHistory();\r\n    this.attachToDOM();\r\n\r\n    console.log('ChatWidget: Initialized', {\r\n      sessionId: this.sessionId,\r\n      config: this.config,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create the main container element\r\n   */\r\n  createContainer() {\r\n    this.container = document.createElement('div');\r\n    this.container.className = `csai-widget-container position-${this.config.position}`;\r\n    // Ensure container is fixed and doesn't scroll with page\r\n    this.container.style.position = 'fixed';\r\n    this.container.style.zIndex = '999999';\r\n    \r\n    // Explicitly set positioning to ensure it works (CSS classes should handle this, but this is a fallback)\r\n    const position = this.config.position || 'bottom-right';\r\n    if (position.includes('bottom')) {\r\n      this.container.style.bottom = '20px';\r\n      this.container.style.top = 'auto';\r\n    } else {\r\n      this.container.style.top = '20px';\r\n      this.container.style.bottom = 'auto';\r\n    }\r\n    if (position.includes('right')) {\r\n      this.container.style.right = '20px';\r\n      this.container.style.left = 'auto';\r\n    } else {\r\n      this.container.style.left = '20px';\r\n      this.container.style.right = 'auto';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create Shadow DOM for style encapsulation\r\n   */\r\n  createShadowDOM() {\r\n    this.shadowRoot = this.container.attachShadow({ mode: 'open' });\r\n  }\r\n\r\n  /**\r\n   * Inject CSS styles into Shadow DOM\r\n   */\r\n  injectStyles() {\r\n    const styleElement = document.createElement('style');\r\n    styleElement.textContent = styles;\r\n\r\n    // Apply all custom colors as CSS variables\r\n    styleElement.textContent += `\r\n      :host {\r\n        --primary-color: ${this.config.primaryColor};\r\n        --primary-hover: ${this.adjustColor(this.config.primaryColor, -20)};\r\n        --background: ${this.config.bodyBgColor};\r\n        --header-bg: ${this.config.headerBgColor};\r\n        --footer-bg: ${this.config.footerBgColor};\r\n        --user-message-bg: ${this.config.userBubbleColor};\r\n        --user-message-text: ${this.config.userTextColor};\r\n        --ai-message-bg: ${this.config.aiBubbleColor};\r\n        --ai-message-text: ${this.config.aiTextColor};\r\n      }\r\n    `;\r\n\r\n    this.shadowRoot.appendChild(styleElement);\r\n  }\r\n\r\n  /**\r\n   * Adjust color brightness\r\n   * @param {string} color - Hex color\r\n   * @param {number} amount - Amount to adjust (-255 to 255)\r\n   * @returns {string} Adjusted hex color\r\n   */\r\n  adjustColor(color, amount) {\r\n    const clamp = (val) => Math.min(Math.max(val, 0), 255);\r\n    const num = parseInt(color.replace('#', ''), 16);\r\n    const r = clamp((num >> 16) + amount);\r\n    const g = clamp(((num >> 8) & 0x00ff) + amount);\r\n    const b = clamp((num & 0x0000ff) + amount);\r\n    return `#${(r << 16 | g << 8 | b).toString(16).padStart(6, '0')}`;\r\n  }\r\n\r\n  /**\r\n   * Create widget components\r\n   */\r\n  createComponents() {\r\n    // Create chat bubble\r\n    this.bubble = new ChatBubble(() => this.toggleWindow(), this.config);\r\n\r\n    // Create chat window\r\n    this.window = new ChatWindow(\r\n      this.config,\r\n      () => this.handleClose(),\r\n      (message) => this.handleSend(message)\r\n    );\r\n\r\n    // Append components to shadow DOM\r\n    this.shadowRoot.appendChild(this.bubble.getElement());\r\n    this.shadowRoot.appendChild(this.window.getElement());\r\n\r\n    // Initialize window\r\n    this.window.init();\r\n    \r\n    // Show bubble when window is closed, hide when open\r\n    this.updateBubbleVisibility();\r\n  }\r\n\r\n  /**\r\n   * Load conversation history\r\n   */\r\n  async loadHistory() {\r\n    try {\r\n      // First try to load from localStorage\r\n      const cachedMessages = this.storage.getMessages();\r\n      if (cachedMessages && cachedMessages.length > 0) {\r\n        // Filter out system messages from cache (safety check)\r\n        const filteredMessages = cachedMessages.filter(msg => \r\n          msg.role === 'user' || msg.role === 'assistant'\r\n        );\r\n        if (filteredMessages.length > 0) {\r\n          this.window.loadMessages(filteredMessages);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // If no cached messages, try to fetch from API\r\n      const messages = await this.api.getHistory(this.sessionId);\r\n      if (messages && messages.length > 0) {\r\n        // Filter out system and tool messages (safety check)\r\n        const filteredMessages = messages.filter(msg => \r\n          msg.role === 'user' || msg.role === 'assistant'\r\n        );\r\n        \r\n        // Convert API format to widget format\r\n        const formattedMessages = filteredMessages.map(msg => ({\r\n          role: msg.role,\r\n          content: msg.content,\r\n          timestamp: new Date(msg.created_at),\r\n        }));\r\n\r\n        this.window.loadMessages(formattedMessages);\r\n        this.storage.saveMessages(formattedMessages);\r\n      } else {\r\n        // No messages from API - show empty state with greeting\r\n        this.window.loadMessages([]);\r\n      }\r\n    } catch (error) {\r\n      console.error('ChatWidget: Failed to load history', error);\r\n      // Show empty state if history load fails\r\n      this.window.loadMessages([]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Attach widget to the DOM\r\n   */\r\n  attachToDOM() {\r\n    document.body.appendChild(this.container);\r\n\r\n    // Restore widget state from storage\r\n    const shouldBeOpen = this.storage.getWidgetState();\r\n    if (shouldBeOpen) {\r\n      this.window.open();\r\n    }\r\n    this.updateBubbleVisibility();\r\n  }\r\n\r\n  /**\r\n   * Toggle window open/closed\r\n   */\r\n  toggleWindow() {\r\n    this.window.toggle();\r\n    this.storage.setWidgetState(this.window.isOpen);\r\n    this.updateBubbleVisibility();\r\n\r\n    // Clear unread count when opening\r\n    if (this.window.isOpen) {\r\n      this.bubble.setUnreadCount(0);\r\n      this.storage.setUnreadCount(0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update bubble visibility based on window state\r\n   */\r\n  updateBubbleVisibility() {\r\n    if (this.bubble && this.window) {\r\n      // Show bubble when window is closed, hide when open\r\n      if (this.window.isOpen) {\r\n        this.bubble.getElement().style.display = 'none';\r\n      } else {\r\n        this.bubble.getElement().style.display = 'flex';\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle window close\r\n   */\r\n  handleClose() {\r\n    this.storage.setWidgetState(false);\r\n    this.updateBubbleVisibility();\r\n  }\r\n\r\n  /**\r\n   * Handle sending a message\r\n   * @param {string} messageText - User's message\r\n   */\r\n  async handleSend(messageText) {\r\n    // Add user message to UI\r\n    const userMessage = {\r\n      role: 'user',\r\n      content: messageText,\r\n      timestamp: new Date(),\r\n    };\r\n\r\n    this.window.addMessage(userMessage);\r\n\r\n    // Save to storage\r\n    const allMessages = this.window.getMessages();\r\n    this.storage.saveMessages(allMessages);\r\n\r\n    // Disable input and show typing\r\n    this.window.disableInput();\r\n    this.window.showTyping();\r\n\r\n    // Store pending message for retry\r\n    this.pendingMessage = messageText;\r\n\r\n    try {\r\n      // Send to API\r\n      const response = await this.api.sendMessage(this.sessionId, messageText);\r\n\r\n      // Hide typing indicator\r\n      this.window.hideTyping();\r\n\r\n      // Add AI response to UI\r\n      const aiMessage = {\r\n        role: 'assistant',\r\n        content: response.response,\r\n        timestamp: new Date(),\r\n      };\r\n\r\n      this.window.addMessage(aiMessage);\r\n\r\n      // Save to storage\r\n      const updatedMessages = this.window.getMessages();\r\n      this.storage.saveMessages(updatedMessages);\r\n\r\n      // If window is closed, increment unread count\r\n      if (!this.window.isOpen) {\r\n        const currentUnread = this.storage.getUnreadCount();\r\n        const newUnread = currentUnread + 1;\r\n        this.bubble.setUnreadCount(newUnread);\r\n        this.storage.setUnreadCount(newUnread);\r\n      }\r\n\r\n      // Clear pending message\r\n      this.pendingMessage = null;\r\n\r\n    } catch (error) {\r\n      console.error('ChatWidget: Failed to send message', error);\r\n\r\n      // Hide typing indicator\r\n      this.window.hideTyping();\r\n\r\n      // Show error with retry option\r\n      this.window.showError(\r\n        'Failed to send message. Please try again.',\r\n        () => this.retryLastMessage()\r\n      );\r\n    } finally {\r\n      // Re-enable input\r\n      this.window.enableInput();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retry the last failed message\r\n   */\r\n  retryLastMessage() {\r\n    if (this.pendingMessage) {\r\n      this.handleSend(this.pendingMessage);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Public API: Open the widget\r\n   */\r\n  open() {\r\n    if (!this.window.isOpen) {\r\n      this.toggleWindow();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Public API: Close the widget\r\n   */\r\n  close() {\r\n    if (this.window.isOpen) {\r\n      this.toggleWindow();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Public API: Clear conversation history\r\n   */\r\n  clearHistory() {\r\n    this.storage.clearAll();\r\n    this.sessionId = this.storage.getSessionId();\r\n    this.window.loadMessages([]);\r\n  }\r\n\r\n  /**\r\n   * Public API: Destroy the widget\r\n   */\r\n  destroy() {\r\n    if (this.container && this.container.parentNode) {\r\n      this.container.parentNode.removeChild(this.container);\r\n    }\r\n  }\r\n}\r\n","import { ChatWidget } from './widget.js';\r\n\r\n/**\r\n * CSAI Chat Widget Entry Point\r\n * Auto-initializes the widget based on script tag data attributes\r\n */\r\n\r\n/**\r\n * Get configuration from the script tag's data attributes\r\n * @returns {Object} Configuration object\r\n */\r\nfunction getConfigFromScript() {\r\n  const scripts = document.querySelectorAll('script[data-api-key]');\r\n  const script = scripts[scripts.length - 1]; // Get the most recent script\r\n\r\n  if (!script) {\r\n    console.error('ChatWidget: No script tag found with data-api-key attribute');\r\n    return null;\r\n  }\r\n\r\n  const config = {\r\n    apiKey: script.getAttribute('data-api-key'),\r\n    // API URL is hardcoded in widget - no need to expose it in snippet\r\n    position: script.getAttribute('data-position'),\r\n    primaryColor: script.getAttribute('data-primary-color'),\r\n    backgroundColor: script.getAttribute('data-background-color'),\r\n    headerBgColor: script.getAttribute('data-header-bg-color'),\r\n    bodyBgColor: script.getAttribute('data-body-bg-color'),\r\n    footerBgColor: script.getAttribute('data-footer-bg-color'),\r\n    aiBubbleColor: script.getAttribute('data-ai-bubble-color'),\r\n    userBubbleColor: script.getAttribute('data-user-bubble-color'),\r\n    headerTextColor: script.getAttribute('data-header-text-color'),\r\n    aiTextColor: script.getAttribute('data-ai-text-color'),\r\n    userTextColor: script.getAttribute('data-user-text-color'),\r\n    inputBgColor: script.getAttribute('data-input-bg-color'),\r\n    inputTextColor: script.getAttribute('data-input-text-color'),\r\n    buttonTextColor: script.getAttribute('data-button-text-color'),\r\n    greeting: script.getAttribute('data-greeting'),\r\n    title: script.getAttribute('data-title'),\r\n    subtitle: script.getAttribute('data-subtitle'),\r\n  };\r\n\r\n  // Remove null/undefined values\r\n  Object.keys(config).forEach(key => {\r\n    if (config[key] === null || config[key] === undefined) {\r\n      delete config[key];\r\n    }\r\n  });\r\n\r\n  return config;\r\n}\r\n\r\n/**\r\n * Initialize the widget when DOM is ready\r\n */\r\nfunction initWidget() {\r\n  const config = getConfigFromScript();\r\n\r\n  if (!config) {\r\n    console.error('ChatWidget: Failed to get configuration from script tag');\r\n    return;\r\n  }\r\n\r\n  if (!config.apiKey) {\r\n    console.error('ChatWidget: data-api-key attribute is required');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const widget = new ChatWidget(config);\r\n\r\n    // Expose widget instance globally for manual control\r\n    window.CSAIWidget = widget;\r\n\r\n    console.log('ChatWidget: Successfully initialized');\r\n  } catch (error) {\r\n    console.error('ChatWidget: Initialization failed', error);\r\n  }\r\n}\r\n\r\n// Auto-initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', initWidget);\r\n} else {\r\n  // DOM is already ready\r\n  initWidget();\r\n}\r\n\r\n// Export for manual initialization\r\nexport { ChatWidget };\r\n"],"names":["ChatAPI","constructor","apiKey","baseUrl","this","replace","sendMessage","sessionId","message","response","fetch","method","headers","Authorization","body","JSON","stringify","ok","error","json","catch","Error","status","statusText","console","getHistory","messages","endSession","WidgetStorage","prefix","isAvailable","checkAvailability","test","localStorage","setItem","removeItem","e","warn","generateSessionId","Date","now","Math","random","toString","substring","getSessionId","get","set","key","fullKey","value","getItem","parse","remove","saveMessages","recentMessages","slice","getMessages","setWidgetState","isOpen","getWidgetState","setUnreadCount","count","getUnreadCount","clearAll","forEach","ChatBubble","onClick","config","element","create","unreadCount","applyColors","bubble","document","createElement","className","setAttribute","innerHTML","addEventListener","toggleOpen","headerBgColor","style","backgroundColor","headerTextColor","svg","querySelector","fill","classList","toggle","existingBadge","badge","textContent","appendChild","getElement","MessageList","container","addMessage","push","messageEl","createMessageElement","scrollToBottom","messageDiv","role","content","time","formatTime","timestamp","date","getHours","padStart","getMinutes","showTyping","hideTyping","typing","indicator","showError","errorText","onRetry","errorDiv","loadMessages","clear","filteredMessages","filter","msg","showEmptyState","greeting","emptyState","setTimeout","scrollTop","scrollHeight","InputArea","onSend","input","sendButton","autoResize","updateSendButton","shiftKey","preventDefault","handleSend","footerBgColor","inputBgColor","inputTextColor","color","buttonTextColor","width","height","min","hasText","trim","length","disabled","focus","setValue","disable","enable","ChatWindow","onClose","messageList","inputArea","window","header","createHeader","title","subtitle","closeButton","close","init","open","add","disableInput","enableInput","ChatWidget","parseConfig","api","apiUrl","storage","shadowRoot","pendingMessage","position","primaryColor","bodyBgColor","aiBubbleColor","userBubbleColor","aiTextColor","userTextColor","createContainer","createShadowDOM","injectStyles","createComponents","loadHistory","attachToDOM","log","zIndex","includes","bottom","top","right","left","attachShadow","mode","styleElement","adjustColor","amount","clamp","val","max","num","parseInt","toggleWindow","handleClose","updateBubbleVisibility","cachedMessages","formattedMessages","map","created_at","display","messageText","userMessage","allMessages","aiMessage","updatedMessages","newUnread","retryLastMessage","clearHistory","destroy","parentNode","removeChild","initWidget","scripts","querySelectorAll","script","getAttribute","Object","keys","getConfigFromScript","widget","CSAIWidget","readyState"],"mappings":"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"}